# 开发环境兼容性说明\n\n## macOS 版本兼容问题\n\n如果您遇到 macOS 版本不兼容的问题（需要 13.5.0+），可以使用以下解决方案：\n\n### 方案一：更新 Wrangler（推荐）\n\n```bash\ncd backend\n\n# 更新到最新版本\nnpm install --save-dev wrangler@latest\n\n# 使用 npx 运行\nnpx wrangler dev\n```\n\n### 方案二：使用 Docker（推荐用于不兼容的 macOS）\n\n创建 `backend/Dockerfile.dev`：\n\n```dockerfile\nFROM node:18-alpine\n\nWORKDIR /app\n\n# 安装依赖\nCOPY package*.json ./\nRUN npm install\n\n# 复制源代码\nCOPY . .\n\n# 暴露端口\nEXPOSE 8787\n\n# 启动开发服务器\nCMD [\"npm\", \"run\", \"dev\", \"--\", \"--ip\", \"0.0.0.0\"]\n```\n\n创建 `backend/docker-compose.yml`：\n\n```yaml\nversion: '3.8'\nservices:\n  backend:\n    build:\n      context: .\n      dockerfile: Dockerfile.dev\n    ports:\n      - \"8787:8787\"\n    volumes:\n      - .:/app\n      - /app/node_modules\n    environment:\n      - NODE_ENV=development\n```\n\n使用 Docker 运行：\n\n```bash\ncd backend\ndocker-compose up\n```\n\n### 方案三：使用在线开发环境\n\n1. **GitHub Codespaces**\n   - 直接在 GitHub 上打开项目\n   - 点击绿色的 \"Code\" 按钮 → \"Codespaces\" → \"Create codespace\"\n\n2. **Gitpod**\n   - 访问 `https://gitpod.io/#https://github.com/Rexingleung/mastra-fortune-telling`\n\n### 方案四：模拟后端（快速测试）\n\n如果只是想测试前端，可以创建一个简单的模拟后端：\n\n```bash\ncd backend\nnpm install express cors\n```\n\n创建 `backend/mock-server.js`：\n\n```javascript\nconst express = require('express');\nconst cors = require('cors');\nconst app = express();\n\napp.use(cors());\napp.use(express.json());\n\n// 健康检查\napp.get('/', (req, res) => {\n  res.json({ \n    message: '天机阁 API 服务运行中 🔮',\n    timestamp: new Date().toISOString(),\n    services: ['tarot', 'fengshui', 'zodiac', 'naming', 'guzi', 'chat']\n  });\n});\n\n// 模拟聊天流式接口\napp.post('/api/chat/stream', (req, res) => {\n  res.writeHead(200, {\n    'Content-Type': 'text/plain',\n    'Cache-Control': 'no-cache',\n    'Connection': 'keep-alive',\n  });\n\n  const message = '🔮 根据您的问题，我为您解读如下：这是一个充满可能性的时期，建议您保持积极的心态，相信自己的直觉。命运掌握在自己手中，算命只是为您提供参考和启发。';\n  \n  // 模拟打字机效果\n  let i = 0;\n  const interval = setInterval(() => {\n    if (i < message.length) {\n      res.write(`data: ${JSON.stringify(message[i])}\\n\\n`);\n      i++;\n    } else {\n      res.write(`data: ${JSON.stringify({ finishReason: 'stop' })}\\n\\n`);\n      res.end();\n      clearInterval(interval);\n    }\n  }, 100);\n});\n\n// 其他API模拟\napp.post('/api/tarot/draw', (req, res) => {\n  res.json({\n    readingId: `reading-${Date.now()}`,\n    cards: [{ id: 0, name: 'The Fool', nameCn: '愚者', meaning: '新开始', isReversed: false }],\n    spreadType: 'single'\n  });\n});\n\napp.post('/api/zodiac/fortune', (req, res) => {\n  res.json({\n    fortuneId: `zodiac-${Date.now()}`,\n    fortune: '⭐ 您的星座运势整体向好，特别是在人际关系方面会有突破。',\n    sign: req.body.sign\n  });\n});\n\n// 其他路由...\n\nconst PORT = 8787;\napp.listen(PORT, () => {\n  console.log(`🚀 模拟后端服务器运行在 http://localhost:${PORT}`);\n});\n```\n\n在 `backend/package.json` 中添加脚本：\n\n```json\n{\n  \"scripts\": {\n    \"dev\": \"npx wrangler dev\",\n    \"dev:mock\": \"node mock-server.js\",\n    \"deploy\": \"npx wrangler deploy\"\n  }\n}\n```\n\n运行模拟后端：\n\n```bash\ncd backend\nnpm run dev:mock\n```\n\n### 推荐流程\n\n1. **优先尝试方案一**：更新 Wrangler\n2. **如果仍有问题**：使用方案二 Docker\n3. **快速测试**：使用方案四模拟后端\n4. **生产部署**：直接使用 `wrangler deploy`\n\n这样您就可以在任何环境下继续开发了！🚀"